/* =============================================
   SPIRE CAMPAIGN MANAGER — REDESIGNED STYLES
   Dark fantasy aesthetic with GM/Player duality
   ============================================= */

/* Fonts loaded via Google Fonts:
   - Cinzel: Display headings (ancient, authoritative)
   - Crimson Pro: Body text (elegant, readable) */

:root {
  /* Core palette — LIGHT (default) */
  --spire-black:    #f5f0e8;
  --spire-deep:     #ede5d8;
  --spire-dark:     #e2d8c6;
  --spire-mid:      #d4c9b2;
  --spire-light:    #c4b498;
  --spire-border:   #a89878;
  --spire-text:     #1e1a14;
  --spire-muted:    #5c5040;
  --spire-dim:      #8c7c68;

  /* GM accent — deep crimson */
  --gm-accent:      #9a2018;
  --gm-accent-lo:   #6a1410;
  --gm-accent-hi:   #c03020;
  --gm-glow:        rgba(154,32,24,0.10);

  /* Player accent — warm amber */
  --pl-accent:      #7a5f14;
  --pl-accent-lo:   #4e3c0c;
  --pl-accent-hi:   #a07c18;
  --pl-glow:        rgba(122,95,20,0.10);

  /* Entity type colors — darker for light mode */
  --pc-color:       #1a6fa0;
  --npc-color:      #1e6a2e;
  --org-color:      #8a4010;

  /* Stress track colors — saturated for light mode */
  --blood-color:    #b02020;
  --mind-color:     #5848a0;
  --silver-color:   #2870a0;
  --shadow-color:   #2a6050;
  --rep-color:      #806020;

  /* Active theme (default GM) */
  --accent:         var(--gm-accent);
  --accent-lo:      var(--gm-accent-lo);
  --accent-hi:      var(--gm-accent-hi);
  --accent-glow:    var(--gm-glow);

  /* Sizing */
  --radius:         6px;
  --radius-lg:      10px;
  --nav-h:          52px;
  --sidebar-w:      270px;
  --inspector-w:    330px;
}

/* Player mode overrides */
body.player-mode {
  --accent:         var(--pl-accent);
  --accent-lo:      var(--pl-accent-lo);
  --accent-hi:      var(--pl-accent-hi);
  --accent-glow:    var(--pl-glow);
}

/* -----------------------------------------------
   DARK MODE — deep navy/obsidian
----------------------------------------------- */
body.dark {
  --spire-black:    #060b12;
  --spire-deep:     #0d1825;
  --spire-dark:     #152234;
  --spire-mid:      #1e3350;
  --spire-light:    #2a4870;
  --spire-border:   #2f4f72;
  --spire-text:     #c8d8e8;
  --spire-muted:    #6b8aaa;
  --spire-dim:      #3a5570;

  --gm-accent:      #c0392b;
  --gm-accent-lo:   #7d2218;
  --gm-accent-hi:   #e05a4b;
  --gm-glow:        rgba(192,57,43,0.18);

  --pl-accent:      #c9a227;
  --pl-accent-lo:   #8a6d19;
  --pl-accent-hi:   #e8c060;
  --pl-glow:        rgba(201,162,39,0.18);

  --pc-color:       #4eade0;
  --npc-color:      #5dba7a;
  --org-color:      #e07c4e;

  --blood-color:    #d44;
  --mind-color:     #89d;
  --silver-color:   #9cc;
  --shadow-color:   #7a9;
  --rep-color:      #ca8;
}

/* =============================================
   RESET & BASE
   ============================================= */

*, *::before, *::after { box-sizing: border-box; }

html, body {
  margin: 0; padding: 0;
  height: 100%;
  background: var(--spire-black);
  color: var(--spire-text);
  font-family: 'Crimson Pro', Georgia, serif;
  font-size: 16px;
  line-height: 1.5;
  overflow: hidden;
}

h1, h2, h3, h4 {
  font-family: 'Cinzel', serif;
  font-weight: 600;
  letter-spacing: 0.03em;
  color: var(--spire-text);
}

button { font-family: inherit; cursor: pointer; }
input, select, textarea { font-family: inherit; }
input, select, textarea, input::placeholder, textarea::placeholder { color: inherit; }

/* Keep form text legible when toggling dark mode (including autofill). */
body.dark input,
body.dark select,
body.dark textarea {
  color: var(--spire-text);
}
body.dark input::placeholder,
body.dark textarea::placeholder {
  color: var(--spire-dim);
}
body.dark input:-webkit-autofill,
body.dark input:-webkit-autofill:hover,
body.dark input:-webkit-autofill:focus {
  -webkit-text-fill-color: var(--spire-text);
  -webkit-box-shadow: 0 0 0 1000px var(--spire-dark) inset;
}

/* Scrollbar styling */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--spire-deep); }
::-webkit-scrollbar-thumb { background: var(--spire-border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent); }

/* =============================================
   MODE SELECTION SCREEN
   ============================================= */

#mode-screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#auth-screen {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.auth-screen-content {
  position: relative;
  z-index: 1;
  width: 100%;
  max-width: 480px;
  padding: 30px 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.auth-card {
  width: 100%;
  background: rgba(11,11,14,0.92);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius-lg);
  padding: 14px;
}

.auth-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.auth-tab {
  flex: 1;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  color: var(--spire-text);
  border-radius: var(--radius);
  padding: 8px 10px;
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
}

.auth-tab.active {
  border-color: var(--accent);
  background: var(--accent-glow);
  color: var(--accent-hi);
}

.auth-fields {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.auth-fields label {
  font-family: 'Cinzel', serif;
  font-size: 0.66rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--spire-muted);
  margin-top: 6px;
}

.auth-fields input {
  padding: 9px 10px;
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
}

.auth-fields input:focus {
  outline: none;
  border-color: var(--accent);
}

.auth-submit-btn {
  width: 100%;
  margin-top: 12px;
}

.auth-message {
  min-height: 18px;
  margin: 10px 0 0;
  color: var(--spire-dim);
  font-size: 0.82rem;
}

.auth-message.error {
  color: #dca9a9;
}

.mode-screen-bg {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at 30% 20%, rgba(154,32,24,0.12) 0%, transparent 60%),
    radial-gradient(ellipse at 70% 80%, rgba(122,95,20,0.08) 0%, transparent 60%),
    linear-gradient(180deg, var(--spire-black) 0%, var(--spire-deep) 100%);
}

/* Hex grid overlay */
.mode-screen-bg::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 58px, rgba(255,255,255,0.015) 58px, rgba(255,255,255,0.015) 60px),
    repeating-linear-gradient(60deg, transparent, transparent 58px, rgba(255,255,255,0.01) 58px, rgba(255,255,255,0.01) 60px),
    repeating-linear-gradient(120deg, transparent, transparent 58px, rgba(255,255,255,0.01) 58px, rgba(255,255,255,0.01) 60px);
  pointer-events: none;
}

.mode-screen-content {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 36px;
  width: 100%;
  max-width: 600px;
  padding: 40px 24px;
}

.mode-logo {
  text-align: center;
}

.mode-logo-icon {
  font-size: 3rem;
  color: var(--accent);
  line-height: 1;
  margin-bottom: 8px;
  filter: drop-shadow(0 0 20px var(--gm-accent));
  animation: pulse-glow 3s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { filter: drop-shadow(0 0 12px var(--gm-accent)); }
  50%       { filter: drop-shadow(0 0 28px var(--gm-accent)); }
}

.mode-logo h1 {
  font-family: 'Cinzel', serif;
  font-size: 3.5rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  color: #fff;
  margin: 0;
  text-shadow: 0 0 40px rgba(192,57,43,0.5);
}

.mode-logo p {
  font-family: 'Crimson Pro', serif;
  font-size: 1rem;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  color: var(--spire-muted);
  margin: 4px 0 0;
}

.mode-campaign-selector {
  width: 100%;
  max-width: 460px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mode-user-row {
  width: 100%;
  max-width: 460px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

#mode-current-user {
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

.mode-campaign-selector > label {
  font-family: 'Cinzel', serif;
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

.mode-campaign-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.mode-campaign-row select {
  flex: 1;
  padding: 10px 14px;
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Cinzel', serif;
  font-size: 0.9rem;
  outline: none;
  transition: border-color 0.2s;
}

.mode-campaign-row select:focus {
  border-color: var(--accent);
}

.mode-campaign-row button {
  width: 40px;
  height: 40px;
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-muted);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.mode-campaign-row button:hover {
  background: var(--spire-mid);
  color: var(--accent);
  border-color: var(--accent);
}

.mode-buttons {
  display: flex;
  gap: 20px;
  width: 100%;
  max-width: 480px;
}

.mode-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 28px 20px;
  border: 1px solid var(--spire-border);
  border-radius: var(--radius-lg);
  background: var(--spire-dark);
  color: var(--spire-text);
  text-align: center;
  transition: all 0.25s ease;
  position: relative;
  overflow: hidden;
}

.mode-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 0.25s;
}

.mode-btn-gm::before {
  background: radial-gradient(ellipse at top, rgba(192,57,43,0.15), transparent 70%);
}

.mode-btn-player::before {
  background: radial-gradient(ellipse at top, rgba(201,162,39,0.15), transparent 70%);
}

.mode-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 30px rgba(0,0,0,0.4);
}

.mode-btn-gm:hover {
  border-color: var(--gm-accent);
  box-shadow: 0 8px 30px rgba(192,57,43,0.25);
}

.mode-btn-player:hover {
  border-color: var(--pl-accent);
  box-shadow: 0 8px 30px rgba(201,162,39,0.25);
}

.mode-btn:hover::before { opacity: 1; }

.mode-btn-icon {
  position: relative;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--spire-mid);
  transition: background 0.25s;
}

.mode-btn-gm .mode-btn-icon {
  background: rgba(192,57,43,0.2);
  border: 1px solid rgba(192,57,43,0.4);
}

.mode-btn-player .mode-btn-icon {
  background: rgba(201,162,39,0.2);
  border: 1px solid rgba(201,162,39,0.4);
}

.mode-btn-gm .mode-btn-icon .material-icons { color: var(--gm-accent-hi); font-size: 28px; }
.mode-btn-player .mode-btn-icon .material-icons { color: var(--pl-accent-hi); font-size: 28px; }

.mode-btn-label {
  font-family: 'Cinzel', serif;
  font-size: 1.1rem;
  font-weight: 600;
  letter-spacing: 0.08em;
}

.mode-btn-desc {
  font-size: 0.85rem;
  color: var(--spire-muted);
  line-height: 1.4;
}

.mode-footer {
  font-size: 0.8rem;
  color: var(--spire-dim);
  letter-spacing: 0.05em;
}

/* =============================================
   TOP NAV
   ============================================= */

#top-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--spire-deep);
  border-bottom: 1px solid var(--spire-border);
  height: var(--nav-h);
  padding: 0 12px;
  position: relative;
  z-index: 100;
  box-shadow: 0 2px 12px rgba(0,0,0,0.4);
}

/* Accent line under nav based on mode */
#top-nav::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  opacity: 0.6;
}

.nav-left, .nav-right {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 200px;
}

.nav-right { justify-content: flex-end; }

.nav-brand {
  display: flex;
  align-items: center;
  gap: 8px;
}

.nav-brand-icon {
  font-size: 1.3rem;
  color: var(--accent);
  opacity: 0.8;
}

.nav-title {
  font-family: 'Cinzel', serif;
  font-size: 1rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  color: var(--spire-text);
  cursor: pointer;
}

.nav-title:hover { color: var(--accent-hi); }

.mode-badge {
  font-family: 'Cinzel', serif;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  padding: 2px 8px;
  border-radius: 20px;
  text-transform: uppercase;
}

.mode-badge-gm {
  background: rgba(192,57,43,0.2);
  border: 1px solid rgba(192,57,43,0.5);
  color: var(--gm-accent-hi);
}

.mode-badge-player {
  background: rgba(201,162,39,0.2);
  border: 1px solid rgba(201,162,39,0.5);
  color: var(--pl-accent-hi);
}

.nav-icon-btn {
  background: transparent;
  border: 1px solid transparent;
  color: var(--spire-muted);
  width: 36px;
  height: 36px;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}

.nav-icon-btn:hover {
  background: var(--spire-mid);
  color: var(--spire-text);
  border-color: var(--spire-border);
}

.nav-icon-btn .material-icons { font-size: 20px; }

/* Tab links */
.nav-middle {
  display: flex;
  align-items: center;
  gap: 2px;
}

.tab-link {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--spire-muted);
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  border-radius: var(--radius);
  position: relative;
  transition: all 0.15s;
}

.tab-link .tab-icon { font-size: 16px; }

.tab-link:hover {
  background: var(--spire-mid);
  color: var(--spire-text);
}

.tab-link.active {
  color: var(--accent-hi);
  background: var(--accent-glow);
}

.tab-link.active::after {
  content: '';
  position: absolute;
  bottom: -9px; left: 20%; right: 20%;
  height: 2px;
  background: var(--accent);
  border-radius: 1px;
}

/* =============================================
   LAYOUT
   ============================================= */

#layout {
  display: flex;
  height: calc(100vh - var(--nav-h));
}

/* =============================================
   SIDEBAR
   ============================================= */

#sidebar {
  width: var(--sidebar-w);
  background: var(--spire-deep);
  border-right: 1px solid var(--spire-border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;
}

.sidebar-header {
  padding: 12px;
  border-bottom: 1px solid var(--spire-border);
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: var(--spire-dark);
}

.search-wrap {
  position: relative;
  display: flex;
  align-items: center;
}

.search-icon {
  position: absolute;
  left: 8px;
  font-size: 16px;
  color: var(--spire-muted);
  pointer-events: none;
}

#search-input {
  width: 100%;
  padding: 8px 8px 8px 32px;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Crimson Pro', serif;
  font-size: 0.9rem;
  outline: none;
  transition: border-color 0.2s;
}

#search-input::placeholder { color: var(--spire-dim); }
#search-input:focus { border-color: var(--accent); }

.add-buttons {
  display: flex;
  gap: 6px;
}

.add-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 7px 4px;
  border-radius: var(--radius);
  border: 1px solid;
  font-family: 'Cinzel', serif;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  transition: all 0.15s;
}

.add-btn .material-icons { font-size: 16px; }

.add-btn-pc {
  background: rgba(78,173,224,0.08);
  border-color: rgba(78,173,224,0.3);
  color: var(--pc-color);
}

.add-btn-pc:hover {
  background: rgba(78,173,224,0.2);
  border-color: var(--pc-color);
}

.add-btn-npc {
  background: rgba(93,186,122,0.08);
  border-color: rgba(93,186,122,0.3);
  color: var(--npc-color);
}

.add-btn-npc:hover {
  background: rgba(93,186,122,0.2);
  border-color: var(--npc-color);
}

.add-btn-org {
  background: rgba(224,124,78,0.08);
  border-color: rgba(224,124,78,0.3);
  color: var(--org-color);
}

.add-btn-org:hover {
  background: rgba(224,124,78,0.2);
  border-color: var(--org-color);
}

.entity-lists {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

details {
  margin-bottom: 6px;
}

details summary {
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 10px;
  border-radius: var(--radius);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--spire-muted);
  user-select: none;
  transition: all 0.15s;
  list-style: none;
  background: var(--spire-dark);
}

details summary::-webkit-details-marker { display: none; }
details summary::marker { display: none; }

details summary:hover {
  background: var(--spire-mid);
  color: var(--spire-text);
}

details[open] summary { color: var(--accent-hi); }

.summary-icon { font-size: 14px; }

.entity-count {
  margin-left: auto;
  background: var(--spire-mid);
  border-radius: 10px;
  padding: 0px 7px;
  font-size: 0.7rem;
  color: var(--spire-muted);
  min-width: 20px;
  text-align: center;
}

.entity-list {
  list-style: none;
  padding: 4px 0;
  margin: 0;
}

.entity-list li {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 7px 10px;
  margin: 1px 0;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 0.92rem;
  color: var(--spire-text);
  transition: all 0.12s;
  border: 1px solid transparent;
}

.entity-list li:hover {
  background: var(--spire-mid);
  border-color: var(--spire-border);
}

.entity-list li.active {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--accent-hi);
}

.entity-list li .entity-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
}

.entity-list li .gm-badge {
  margin-left: auto;
  font-size: 0.65rem;
  background: rgba(192,57,43,0.2);
  border: 1px solid rgba(192,57,43,0.4);
  color: var(--gm-accent-hi);
  padding: 0 5px;
  border-radius: 3px;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.08em;
}

/* =============================================
   MAIN CONTENT
   ============================================= */

#main-content {
  flex: 1;
  position: relative;
  overflow: hidden;
  background: var(--spire-black);
  display: flex;
  flex-direction: column;
}

.tab-page {
  display: none;
  height: 100%;
  overflow-y: auto;
  flex-direction: column;
  visibility: hidden;
  position: absolute;
  inset: 0;
}

.tab-page.active {
  display: flex;
  visibility: visible;
  position: relative;
  inset: auto;
}

/* =============================================
   SHEETS VIEW
   ============================================= */

#sheets-view {
  padding: 0;
}

.placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 16px;
  color: var(--spire-dim);
  font-style: italic;
}

.placeholder-icon {
  font-size: 3rem;
  opacity: 0.4;
}

.placeholder p { font-size: 1rem; }

.sheet-container {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
}

/* Sheet title bar */
.sheet-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 14px;
  border-bottom: 1px solid var(--spire-border);
}

.sheet-title h2 {
  font-size: 1.5rem;
  margin: 0;
  color: var(--spire-text);
}

.sheet-title .sheet-type-badge {
  font-family: 'Cinzel', serif;
  font-size: 0.7rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 3px 10px;
  border-radius: 20px;
}

.pc-badge   { background: rgba(78,173,224,0.15); border: 1px solid rgba(78,173,224,0.4); color: var(--pc-color); }
.npc-badge  { background: rgba(93,186,122,0.15); border: 1px solid rgba(93,186,122,0.4); color: var(--npc-color); }
.org-badge  { background: rgba(224,124,78,0.15); border: 1px solid rgba(224,124,78,0.4); color: var(--org-color); }

.print-btn {
  background: transparent;
  border: 1px solid var(--spire-border);
  color: var(--spire-muted);
  padding: 6px 14px;
  border-radius: var(--radius);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  transition: all 0.15s;
}

.print-btn:hover {
  border-color: var(--accent);
  color: var(--accent-hi);
}
.print-btn-danger {
  border-color: rgba(192,57,43,0.5);
  color: #d18383;
}
.print-btn-danger:hover {
  border-color: rgba(192,57,43,0.8);
  color: #f0b0b0;
  background: rgba(192,57,43,0.14);
}

/* Sheet sections */
.inspector-section {
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius-lg);
  padding: 16px;
  margin-bottom: 12px;
}

.inspector-section h3 {
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--accent-hi);
  margin: 0 0 14px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--spire-border);
  display: flex;
  align-items: center;
  gap: 8px;
}

.inspector-section h3 .material-icons { font-size: 16px; }

.inspector-field {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
  gap: 4px;
}

.inspector-field label {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

.inspector-field input,
.inspector-field select,
.inspector-field textarea {
  padding: 8px 10px;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Crimson Pro', serif;
  font-size: 0.95rem;
  outline: none;
  transition: border-color 0.2s;
}

.inspector-field input:focus,
.inspector-field select:focus,
.inspector-field textarea:focus {
  border-color: var(--accent);
}

.inspector-field textarea {
  resize: vertical;
  min-height: 60px;
}

.inspector-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 12px;
}

.inspector-actions button {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  background: var(--spire-mid);
  color: var(--spire-text);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  transition: all 0.15s;
}

.inspector-actions button:hover {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--accent-hi);
}

.inspector-actions button.danger {
  border-color: rgba(192,57,43,0.3);
  color: var(--gm-accent-hi);
}

.inspector-actions button.danger:hover {
  background: rgba(192,57,43,0.15);
  border-color: var(--gm-accent);
}

/* GM notes - distinct visual treatment */
.gm-notes-wrapper {
  position: relative;
}

.gm-notes-wrapper::before {
  content: 'GM ONLY';
  position: absolute;
  top: -10px; right: 10px;
  font-family: 'Cinzel', serif;
  font-size: 0.6rem;
  letter-spacing: 0.1em;
  color: var(--gm-accent-hi);
  background: var(--spire-dark);
  padding: 0 6px;
}

.gm-notes-field {
  background: rgba(192,57,43,0.05) !important;
  border-color: rgba(192,57,43,0.3) !important;
}

.gm-notes-field:focus {
  border-color: var(--gm-accent) !important;
}

/* =============================================
   STRESS TRACKS
   ============================================= */

.stress-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  padding: 6px 0;
}

.stress-row + .stress-row {
  border-top: 1px solid rgba(255,255,255,0.04);
}

.stress-label {
  flex: 0 0 90px;
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

.stress-controls {
  display: flex;
  align-items: center;
  gap: 4px;
}

.stress-controls button {
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  color: var(--spire-text);
  width: 24px;
  height: 24px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  line-height: 1;
  transition: all 0.12s;
}

.stress-controls button:hover {
  border-color: var(--accent);
  color: var(--accent-hi);
}

.stress-pips {
  display: flex;
  gap: 3px;
  flex-wrap: wrap;
  flex: 1;
}

.stress-pips .pip {
  width: 12px;
  height: 18px;
  border: 1px solid var(--spire-border);
  border-radius: 2px;
  background: var(--spire-mid);
  cursor: pointer;
  transition: all 0.1s;
}

.stress-pips .pip:hover {
  border-color: var(--accent);
  transform: scaleY(1.1);
}

/* Type-specific pip colors */
.stress-blood   .pip.active { background: var(--blood-color); border-color: var(--blood-color); }
.stress-mind    .pip.active { background: var(--mind-color);  border-color: var(--mind-color);  }
.stress-silver  .pip.active { background: var(--silver-color);border-color: var(--silver-color);}
.stress-shadow  .pip.active { background: var(--shadow-color);border-color: var(--shadow-color);}
.stress-reputation .pip.active { background: var(--rep-color); border-color: var(--rep-color); }

/* =============================================
   CLASS FEATURES
   ============================================= */

.class-refresh {
  font-style: italic;
  color: var(--accent-hi);
  margin-bottom: 10px;
  padding: 8px 12px;
  background: var(--accent-glow);
  border-left: 2px solid var(--accent);
  border-radius: 0 var(--radius) var(--radius) 0;
  font-size: 0.9rem;
}

.class-bond-prompt label {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-muted);
  display: block;
  margin-bottom: 4px;
}

.class-bond-prompt textarea {
  width: 100%;
  min-height: 50px;
  background: var(--spire-mid);
  color: var(--spire-text);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  padding: 8px;
  margin-bottom: 10px;
  font-family: 'Crimson Pro', serif;
  font-size: 0.9rem;
  resize: vertical;
  outline: none;
}
.class-bond-response {
  min-height: 44px;
}

.class-bond-prompt textarea:focus { border-color: var(--accent); }

.class-inv-options { margin-top: 8px; }

.class-inv-option {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 6px;
  padding: 8px 10px;
  border-radius: var(--radius);
  border: 1px solid var(--spire-border);
  background: var(--spire-mid);
  transition: border-color 0.15s;
  cursor: pointer;
}

.class-inv-option:has(input:checked) {
  border-color: var(--accent);
  background: var(--accent-glow);
}

.class-inv-option input[type="radio"] {
  margin-top: 2px;
  accent-color: var(--accent);
}

.portrait-field {
  margin-top: 6px;
}
.portrait-frame {
  width: 100%;
  max-width: 240px;
  aspect-ratio: 3 / 4;
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  background: var(--spire-mid);
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}
.portrait-frame img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.portrait-placeholder {
  color: var(--spire-dim);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  text-align: center;
}
.portrait-controls {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}
.portrait-controls .row-remove-btn {
  margin-left: 0;
}

.class-inv-option label { flex: 1; font-size: 0.9rem; cursor: pointer; }
.class-inv-option small { display: block; font-size: 0.78rem; color: var(--spire-muted); margin-top: 2px; }

.class-core-ability {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: var(--radius);
  border: 1px solid var(--spire-border);
  background: var(--spire-mid);
  margin-bottom: 6px;
}

.class-core-ability input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--accent);
}

.class-adv-level { margin-bottom: 8px; }
.class-adv-level h4 {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--accent-hi);
  margin: 8px 0 4px;
}

.class-adv-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px 10px;
  margin-bottom: 3px;
  border-radius: var(--radius);
  transition: background 0.12s;
  cursor: pointer;
}

.class-adv-option:hover { background: var(--spire-mid); }

.class-adv-option input[type="checkbox"] {
  width: 14px;
  height: 14px;
  accent-color: var(--accent);
}

.class-adv-option label { font-size: 0.88rem; cursor: pointer; }

/* =============================================
   CONSPIRACY WEB VIEW
   ============================================= */

#web-view {
  height: 100%;
  display: flex;
  flex-direction: column;
}

#web-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--spire-deep);
  border-bottom: 1px solid var(--spire-border);
  flex-shrink: 0;
}

.web-toolbar-left, .web-toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.web-toolbar-right {
  flex-wrap: wrap;
  justify-content: flex-end;
}

.toolbar-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 7px 14px;
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  transition: all 0.15s;
}

.toolbar-btn .material-icons { font-size: 16px; }

.toolbar-btn:hover {
  background: var(--spire-mid);
  border-color: var(--accent);
  color: var(--accent-hi);
}

.toolbar-btn-danger:hover {
  background: rgba(192,57,43,0.15);
  border-color: var(--gm-accent);
  color: var(--gm-accent-hi);
}

#web-toolbar select {
  padding: 7px 12px;
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  outline: none;
  transition: border-color 0.2s;
}

#web-toolbar select:focus { border-color: var(--accent); }

#cy-container {
  flex: 1;
  position: relative;
  background: var(--spire-black);
}

/* Grid lines for conspiracy web */
#cy-container::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(var(--spire-border) 1px, transparent 1px),
    linear-gradient(90deg, var(--spire-border) 1px, transparent 1px);
  background-size: 40px 40px;
  opacity: 0.18;
  pointer-events: none;
}

#graph-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}

.graph-empty {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  color: var(--spire-dim);
  pointer-events: none;
}

.graph-empty .material-icons { font-size: 3rem; opacity: 0.4; }
.graph-empty p { font-style: italic; }

/* =============================================
   LOG VIEW
   ============================================= */

#log-view {
  height: 100%;
  display: flex;
  flex-direction: column;
}

#log-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--spire-deep);
  border-bottom: 1px solid var(--spire-border);
  flex-shrink: 0;
}

.log-title {
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

#log-list {
  flex: 1;
  overflow-y: auto;
  list-style: none;
  padding: 8px 12px;
  margin: 0;
}

#log-list li {
  display: flex;
  align-items: baseline;
  gap: 10px;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 0.9rem;
  transition: background 0.1s;
}

#log-list li:hover { background: var(--spire-dark); border-radius: var(--radius); }

#log-list li time {
  font-size: 0.72rem;
  color: var(--spire-dim);
  white-space: nowrap;
  font-family: 'Cinzel', serif;
}

.log-empty {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  color: var(--spire-dim);
  font-style: italic;
}

.log-empty .material-icons { font-size: 2.5rem; opacity: 0.4; }

/* =============================================
   INSPECTOR PANEL
   ============================================= */

#inspector {
  width: var(--inspector-w);
  background: var(--spire-deep);
  border-left: 1px solid var(--spire-border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;
  transition: width 0.25s;
}

#inspector.hidden { display: none; }

.inspector-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-dark);
  flex-shrink: 0;
}

.inspector-title {
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--spire-muted);
}

.close-inspector {
  background: transparent;
  border: none;
  color: var(--spire-muted);
  display: flex;
  align-items: center;
  padding: 4px;
  border-radius: var(--radius);
  transition: all 0.15s;
}

.close-inspector:hover {
  background: var(--spire-mid);
  color: var(--spire-text);
}

.close-inspector .material-icons { font-size: 18px; }

#inspector-content {
  flex: 1;
  overflow-y: auto;
  padding: 14px;
}

#inspector-content h3 {
  font-size: 0.85rem;
  margin: 0 0 14px;
  color: var(--spire-text);
}

/* =============================================
   MODAL
   ============================================= */

#modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(3px);
  z-index: 1000;
}

#modal {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: var(--spire-dark);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius-lg);
  width: 90%;
  max-width: 500px;
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 1001;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}

#modal.hidden, #modal-overlay.hidden { display: none; }

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-deep);
}

.modal-title {
  font-family: 'Cinzel', serif;
  font-size: 0.85rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--spire-text);
}

.close-modal {
  background: transparent;
  border: none;
  color: var(--spire-muted);
  display: flex;
  align-items: center;
  padding: 4px;
  border-radius: var(--radius);
  transition: all 0.15s;
}

.close-modal:hover { background: var(--spire-mid); color: var(--spire-text); }
.close-modal .material-icons { font-size: 18px; }

#modal-content {
  overflow-y: auto;
  padding: 16px;
}

/* Modal form elements */
#modal-content label {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-muted);
  display: block;
  margin-bottom: 4px;
}

#modal-content input,
#modal-content select,
#modal-content textarea {
  width: 100%;
  padding: 8px 10px;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Crimson Pro', serif;
  font-size: 0.95rem;
  outline: none;
  margin-bottom: 12px;
  transition: border-color 0.2s;
}

#modal-content input:focus,
#modal-content select:focus,
#modal-content textarea:focus {
  border-color: var(--accent);
}

#modal-content button[type="submit"],
#modal-content .modal-submit {
  width: 100%;
  padding: 10px;
  background: var(--accent-glow);
  border: 1px solid var(--accent);
  border-radius: var(--radius);
  color: var(--accent-hi);
  font-family: 'Cinzel', serif;
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  transition: all 0.15s;
  margin-top: 4px;
}

#modal-content button[type="submit"]:hover,
#modal-content .modal-submit:hover {
  background: var(--accent);
  color: #fff;
}

/* =============================================
   PLAYER MODE SPECIFIC STYLES
   ============================================= */

/* In player mode, hide GM-only add buttons; show player buttons */
body.player-mode #gm-add-buttons { display: none; }
body.player-mode #player-add-buttons { display: flex; }
body.gm-mode #player-add-buttons { display: none; }
#player-add-buttons { display: none; }

/* Disabled "My Character" button when a PC already exists */
#player-add-pc-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Pending approval badge in sidebar */
.pending-badge {
  margin-left: auto;
  font-size: 0.62rem;
  background: rgba(201,162,39,0.2);
  border: 1px solid rgba(201,162,39,0.5);
  color: var(--pl-accent-hi);
  padding: 0 5px;
  border-radius: 3px;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.06em;
  text-transform: uppercase;
}

/* Pending approval banner on NPC sheet */
.pending-approval-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 14px;
  margin-bottom: 12px;
  background: rgba(201,162,39,0.1);
  border: 1px solid rgba(201,162,39,0.4);
  border-radius: var(--radius);
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  letter-spacing: 0.05em;
  color: var(--pl-accent-hi);
}

.pending-approval-banner .pending-actions {
  display: flex;
  gap: 8px;
}

.pending-approve-btn {
  padding: 5px 12px;
  background: rgba(93,186,122,0.15);
  border: 1px solid rgba(93,186,122,0.5);
  border-radius: var(--radius);
  color: var(--npc-color);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}
.pending-approve-btn:hover {
  background: rgba(93,186,122,0.3);
}

.pending-reject-btn {
  padding: 5px 12px;
  background: rgba(192,57,43,0.12);
  border: 1px solid rgba(192,57,43,0.4);
  border-radius: var(--radius);
  color: var(--gm-accent-hi);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}
.pending-reject-btn:hover {
  background: rgba(192,57,43,0.25);
}

/* Player mode sidebar gets a warm gold accent line */
/* Sidebar needs position:relative for the player accent stripe pseudo-element */
#sidebar { position: relative; }

body.player-mode #sidebar::after {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 3px; height: 100%;
  background: linear-gradient(to bottom, var(--pl-accent), transparent);
  pointer-events: none;
}

/* =============================================
   GM MODE SPECIFIC STYLES
   ============================================= */

body.gm-mode .mode-badge-gm { display: flex; }

/* Secret indicator on entities */
.secret-indicator {
  font-size: 0.65rem;
  background: rgba(192,57,43,0.15);
  border: 1px solid rgba(192,57,43,0.3);
  color: var(--gm-accent-hi);
  padding: 0 5px;
  border-radius: 3px;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.05em;
  margin-left: auto;
}

/* =============================================
   UTILITY
   ============================================= */

.hidden { display: none !important; }

.text-muted { color: var(--spire-muted); }

.divider {
  height: 1px;
  background: var(--spire-border);
  margin: 12px 0;
}

/* Row remove button (×) used across skill/fallout/inventory/task rows */
.row-remove-btn {
  background: transparent;
  border: none;
  color: var(--spire-muted);
  cursor: pointer;
  font-size: 1.1rem;
  line-height: 1;
  padding: 0 4px;
  transition: color 0.15s;
}
.row-remove-btn:hover { color: var(--gm-accent-hi); }

/* Section add button */
.section-add-btn {
  width: 100%;
  padding: 7px;
  margin-top: 8px;
  background: var(--spire-mid);
  border: 1px dashed var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-muted);
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.section-add-btn:hover {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--accent-hi);
}

/* =============================================
   FALLOUT ROWS
   ============================================= */

.fallout-row {
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  padding: 10px;
  margin-bottom: 6px;
}

.fallout-row .fallout-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.fallout-severity {
  font-family: 'Cinzel', serif;
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  padding: 2px 7px;
  border-radius: 10px;
  text-transform: uppercase;
}

.severity-minor   { background: rgba(93,186,122,0.2);  border: 1px solid rgba(93,186,122,0.4);  color: var(--npc-color); }
.severity-moderate{ background: rgba(201,162,39,0.2);  border: 1px solid rgba(201,162,39,0.4);  color: var(--pl-accent-hi); }
.severity-severe  { background: rgba(192,57,43,0.2);   border: 1px solid rgba(192,57,43,0.4);   color: var(--gm-accent-hi); }

/* NPC Bond Stress pip — teal/cyan accent */
.stress-pips .npc-bond-pip.active {
  background: #40a0b0;
  border-color: #40a0b0;
}
body.dark .stress-pips .npc-bond-pip.active {
  background: #5dbace;
  border-color: #5dbace;
}

/* Tag toggle pills */
.tag-toggle-pill {
  display: inline-flex;
  align-items: center;
  padding: 3px 10px;
  border-radius: 10px;
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  color: var(--spire-muted);
  cursor: pointer;
  transition: all 0.15s;
}

.tag-toggle-pill:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.tag-toggle-pill.active {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--accent-hi);
}

/* Stress slot count badge between +/- buttons */
.stress-slot-count {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  font-weight: 700;
  color: var(--spire-muted);
  min-width: 20px;
  text-align: center;
}

/* Hide web and log tabs for players — they only need Sheets */
body.player-mode .tab-link[data-tab="web-view"],
body.player-mode .tab-link[data-tab="log-view"] {
  display: none;
}

/* =============================================
   PRINT
   ============================================= */

@media print {
  body { background: #fff; color: #000; font-family: Georgia, serif; }
  #mode-screen,
  #top-nav,
  #sidebar,
  #inspector,
  #web-toolbar,
  #log-toolbar,
  .add-buttons,
  .section-add-btn,
  .inspector-actions,
  .print-btn,
  .nav-right,
  .nav-middle { display: none !important; }
  #layout { height: auto; display: block; }
  #main-content { width: 100%; }
  #sheets-view { display: block !important; overflow: visible; }
  #sheet-container { display: block !important; border: none; margin: 0; padding: 0; }
  .inspector-section { border: 1px solid #ccc; margin-bottom: 10px; page-break-inside: avoid; }
}

/* =============================================
   TOAST NOTIFICATIONS
   ============================================= */

.spire-toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(60px);
  background: var(--spire-deep);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  font-family: 'Cinzel', serif;
  font-size: 0.82rem;
  letter-spacing: 0.04em;
  padding: 10px 20px;
  z-index: 9999;
  opacity: 0;
  transition: transform 0.25s ease, opacity 0.25s ease;
  pointer-events: none;
  max-width: 420px;
  text-align: center;
}
.spire-toast-show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}
.spire-toast-warn {
  border-color: rgba(201,162,39,0.6);
  color: var(--pl-accent-hi);
}
.spire-toast-info {
  border-color: var(--accent);
}

/* =============================================
   PENDING APPROVAL COUNT BADGE (NAV)
   ============================================= */

.pending-count-badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.05em;
  background: rgba(201,162,39,0.2);
  border: 1px solid rgba(201,162,39,0.5);
  color: var(--pl-accent-hi);
  white-space: nowrap;
  cursor: pointer;
}

/* =============================================
   LOG VIEW ENHANCEMENTS
   ============================================= */

#log-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-dark);
  flex-shrink: 0;
}

.log-toolbar-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.log-toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
}
#log-search-input,
#log-session-filter {
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  color: var(--spire-text);
  padding: 6px 10px;
  font-size: 0.78rem;
}
#log-search-input {
  min-width: 180px;
}
#log-search-input:focus,
#log-session-filter:focus {
  outline: none;
  border-color: var(--accent);
}

.log-session-badge {
  font-size: 0.7rem;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.06em;
  padding: 2px 8px;
  border-radius: 10px;
  background: var(--accent-glow);
  border: 1px solid var(--accent);
  color: var(--accent-hi);
}

#log-note-bar {
  display: flex;
  gap: 6px;
  padding: 8px 12px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-dark);
  flex-shrink: 0;
}
#log-note-input {
  flex: 1;
  font-size: 0.85rem;
}

.log-session-divider {
  list-style: none;
  text-align: center;
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.12em;
  color: var(--accent-hi);
  padding: 8px 0 4px;
  border-top: 1px solid var(--spire-border);
  margin-top: 4px;
  background: transparent;
}
.log-note {
  font-style: italic;
  color: var(--spire-text);
  background: var(--accent-glow);
  border-left: 3px solid var(--accent);
  padding: 4px 8px;
}
.log-session-tag {
  font-family: 'Cinzel', serif;
  font-size: 0.6rem;
  background: var(--accent-glow);
  border: 1px solid var(--accent);
  color: var(--accent-hi);
  border-radius: 3px;
  padding: 0 4px;
  margin-left: 4px;
}

/* =============================================
   DICE ROLLER
   ============================================= */

.dice-roller {
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.dice-btn-row {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.dice-die-btn {
  width: 64px;
  height: 64px;
  border-radius: var(--radius);
  background: var(--die-color, var(--accent));
  border: none;
  color: #fff;
  font-family: 'Cinzel', serif;
  font-size: 1rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}
.dice-die-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.4);
}
.dice-die-btn:active {
  transform: translateY(0);
}
.dice-mod-row {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.85rem;
}
.dice-mod-row select { flex: 1; }
.dice-result {
  min-height: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--spire-mid);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  padding: 12px;
}
.dice-result-prompt {
  color: var(--spire-dim);
  font-style: italic;
  font-size: 0.88rem;
}
.dice-big-result {
  font-family: 'Cinzel', serif;
  font-size: 2.8rem;
  font-weight: 700;
  color: var(--accent-hi);
  line-height: 1;
}
.dice-sub {
  font-size: 0.78rem;
  color: var(--spire-muted);
  margin-top: 4px;
  font-family: 'Crimson Pro', serif;
}
.dice-hist-title {
  font-family: 'Cinzel', serif;
  font-size: 0.7rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--spire-dim);
}
.dice-hist-list {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: 130px;
  overflow-y: auto;
  font-size: 0.82rem;
  color: var(--spire-muted);
}
.dice-hist-list li {
  padding: 2px 0;
  border-bottom: 1px solid var(--spire-border);
}

/* =============================================
   SETTINGS MODAL
   ============================================= */

.modal-field-inline {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-direction: row;
}
.modal-field-inline input[type="checkbox"] {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}
.settings-rel-list {
  max-height: 140px;
  overflow-y: auto;
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  margin-bottom: 6px;
  background: var(--spire-mid);
}
.settings-rel-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 8px;
  border-bottom: 1px solid var(--spire-border);
  font-size: 0.85rem;
}
.settings-danger {
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px solid rgba(192,57,43,0.3);
}
.mode-delete-btn {
  background: transparent;
  border: 1px solid rgba(192,57,43,0.4);
  color: var(--gm-accent-hi);
  border-radius: var(--radius);
  padding: 4px 8px;
  cursor: pointer;
  transition: background 0.15s;
}
.mode-delete-btn:hover { background: rgba(192,57,43,0.15); }

/* =============================================
   CONSPIRACY WEB — LEGEND
   ============================================= */

#web-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 6px 14px;
  padding: 8px 14px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-dark);
  font-size: 0.72rem;
  font-family: 'Cinzel', serif;
  letter-spacing: 0.04em;
  flex-shrink: 0;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
  color: var(--spire-dim);
}
.legend-swatch {
  width: 18px;
  height: 3px;
  border-radius: 2px;
  flex-shrink: 0;
}
.legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
  border: 1px solid rgba(255,255,255,0.2);
}

/* =============================================
   TWO-COLUMN PC SHEET LAYOUT
   ============================================= */

.sheet-two-col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  align-items: start;
}
.pc-identity-section {
  width: min(52%, 620px);
}
.sheet-col .pc-identity-section {
  width: 100%;
  max-width: none;
}
.sheet-col {
  min-width: 0;
}
.sheet-col-left {
  border-right: 1px solid var(--spire-border);
  padding-right: 4px;
}
.sheet-col-right {
  padding-left: 4px;
}
@media (max-width: 820px) {
  .pc-identity-section { width: 100%; }
  .sheet-two-col { grid-template-columns: 1fr; }
  .sheet-col-left { border-right: none; padding-right: 0; border-bottom: 1px solid var(--spire-border); }
  .sheet-col-right { padding-left: 0; }
}

/* =============================================
   COLLAPSIBLE SECTIONS
   ============================================= */

.collapsible-section .section-body {
  overflow: hidden;
  transition: max-height 0.2s ease;
  max-height: 2000px;
}
.collapsible-section.collapsed .section-body {
  max-height: 0;
  overflow: hidden;
}
.section-header {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  user-select: none;
  padding: 6px 0 4px;
  border-bottom: 1px solid var(--spire-border);
  margin-bottom: 6px;
}
.section-header:hover { opacity: 0.85; }
.section-arrow {
  font-size: 0.7rem;
  color: var(--spire-dim);
  flex-shrink: 0;
}
.section-title {
  font-family: 'Cinzel', serif;
  font-size: 0.82rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  color: var(--spire-text);
  flex: 1;
}
.section-help {
  font-size: 0.7rem;
  color: var(--accent);
  cursor: pointer;
  padding: 0 3px;
  border-radius: 50%;
  background: var(--accent-glow);
  border: 1px solid var(--accent);
  flex-shrink: 0;
  line-height: 1.4;
}
.section-help:hover { background: var(--accent); color: #fff; }

/* =============================================
   RESISTANCE DISPLAY WITH STRESS BARS
   ============================================= */

.resistance-display-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  border-bottom: 1px solid var(--spire-border);
}
.resistance-display-row:last-of-type { border-bottom: none; }
.res-name {
  font-family: 'Cinzel', serif;
  font-size: 0.78rem;
  letter-spacing: 0.05em;
  min-width: 75px;
  color: var(--spire-text);
}
.res-value-badge {
  font-family: 'Cinzel', serif;
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--accent-hi);
  min-width: 28px;
}
.res-stress-mini-bar {
  flex: 1;
  height: 6px;
  background: var(--spire-border);
  border-radius: 3px;
  overflow: hidden;
}
.res-stress-fill {
  height: 100%;
  background: var(--gm-accent);
  border-radius: 3px;
  transition: width 0.2s ease;
}
.res-stress-num {
  font-size: 0.72rem;
  color: var(--spire-dim);
  min-width: 36px;
  text-align: right;
}
.res-roll-btn {
  padding: 2px 8px;
  font-size: 0.66rem;
  border: 1px solid var(--spire-border);
  border-radius: 5px;
  background: var(--spire-mid);
  color: var(--spire-text);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.res-roll-btn:hover {
  border-color: var(--accent);
  color: var(--accent-hi);
}

/* =============================================
   STRESS NUMERIC COUNTER
   ============================================= */

.stress-num-counter {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  color: var(--spire-dim);
  min-width: 36px;
  text-align: right;
  order: 3;
}
.stress-row { flex-wrap: wrap; }

/* =============================================
   SKILL MASTERED TOGGLE + ROLL BUTTON
   ============================================= */

.mastered-toggle {
  font-family: 'Cinzel', serif;
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 10px;
  border: 1px solid var(--spire-border);
  background: transparent;
  color: var(--spire-dim);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  flex-shrink: 0;
}
.mastered-toggle.active {
  background: rgba(201,162,39,0.2);
  border-color: rgba(201,162,39,0.6);
  color: var(--pl-accent-hi);
}
.mastered-toggle:hover { opacity: 0.8; }

.skill-roll-btn {
  background: var(--accent-glow);
  border: 1px solid var(--accent);
  color: var(--accent-hi);
  border-radius: 4px;
  padding: 2px 6px;
  cursor: pointer;
  font-size: 1rem;
  line-height: 1;
  transition: background 0.15s;
  flex-shrink: 0;
}
.skill-roll-btn:hover { background: var(--accent); color: #fff; }

/* =============================================
   BONDS SECTION
   ============================================= */

.bond-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
  flex-wrap: wrap;
}
.bond-row select { font-size: 0.78rem; min-width: 100px; }
.bond-row input { font-size: 0.78rem; }

/* =============================================
   REFRESH TOGGLE
   ============================================= */

.class-refresh {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  flex-wrap: wrap;
  padding: 6px 8px;
  background: var(--spire-mid);
  border-radius: var(--radius);
  border: 1px solid var(--spire-border);
  margin-bottom: 8px;
  font-size: 0.85rem;
}
.class-refresh.refreshed {
  border-color: rgba(76,175,80,0.5);
  background: rgba(76,175,80,0.08);
}
.refresh-toggle-btn {
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  padding: 2px 8px;
  border-radius: 10px;
  border: 1px solid var(--spire-border);
  background: transparent;
  color: var(--spire-dim);
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
}
.refresh-toggle-btn.active {
  background: rgba(76,175,80,0.2);
  border-color: rgba(76,175,80,0.6);
  color: #4caf50;
}

/* =============================================
   ADVANCE TIER GATE
   ============================================= */

.class-adv-level.locked { opacity: 0.6; }
.locked-adv label { color: var(--spire-dim); }
.class-adv-level h4 {
  font-size: 0.75rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin: 8px 0 4px;
  color: var(--accent-hi);
  border-bottom: 1px solid var(--spire-border);
  padding-bottom: 2px;
}
.advance-points-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-size: 0.85rem;
}
.advance-points-row input { width: 60px; }

/* =============================================
   FALLOUT SECTION IMPROVEMENTS
   ============================================= */

.fallout-subsection-header {
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--gm-accent-hi);
  padding: 4px 0 2px;
  margin-top: 4px;
  border-bottom: 1px solid var(--spire-border);
}
.fallout-subsection-header.resolved { color: var(--spire-dim); }
.fallout-resolve-btn {
  font-size: 0.7rem;
  padding: 2px 6px;
  border-radius: 10px;
  border: 1px solid var(--spire-border);
  background: transparent;
  color: var(--spire-dim);
  cursor: pointer;
  flex-shrink: 0;
}
.fallout-resolve-btn.resolved {
  background: rgba(76,175,80,0.15);
  border-color: rgba(76,175,80,0.5);
  color: #4caf50;
}

/* =============================================
   SESSION PREP PANEL
   ============================================= */

#log-layout {
  display: flex;
  flex: 1;
  overflow: hidden;
}
.session-prep-panel {
  width: 260px;
  flex-shrink: 0;
  border-right: 1px solid var(--spire-border);
  overflow-y: auto;
  background: var(--spire-dark);
  padding: 10px;
  display: none;
}
#log-list { flex: 1; }

.session-prep-header {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--accent-hi);
  border-bottom: 1px solid var(--spire-border);
  padding-bottom: 6px;
  margin-bottom: 10px;
}
.ministry-row {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.82rem;
  margin-bottom: 4px;
}
.ministry-btn {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--spire-border);
  background: var(--spire-mid);
  color: var(--spire-text);
  cursor: pointer;
  font-size: 0.8rem;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  flex-shrink: 0;
}
.ministry-bar {
  height: 5px;
  background: var(--spire-border);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 10px;
}
.ministry-fill {
  height: 100%;
  background: linear-gradient(to right, var(--gm-accent-lo), var(--gm-accent-hi));
  border-radius: 3px;
  transition: width 0.3s ease;
}
.prep-section {
  margin-bottom: 12px;
}
.prep-section strong {
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--spire-dim);
  display: block;
  margin-bottom: 4px;
  border-bottom: 1px solid var(--spire-border);
  padding-bottom: 2px;
}
.prep-pc-row, .prep-fallout-row, .prep-task-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 4px;
  padding: 2px 0;
  font-size: 0.78rem;
}
.prep-entity-link {
  font-family: 'Cinzel', serif;
  font-size: 0.72rem;
  background: none;
  border: none;
  color: var(--accent-hi);
  cursor: pointer;
  text-decoration: underline;
  padding: 0;
}
.prep-entity-link:hover { opacity: 0.75; }
.stress-pill {
  font-size: 0.65rem;
  padding: 1px 5px;
  border-radius: 8px;
  border: 1px solid var(--spire-border);
  background: var(--spire-mid);
  font-family: 'Cinzel', serif;
  white-space: nowrap;
}
.stress-pill.maxed { background: rgba(192,57,43,0.25); border-color: var(--gm-accent); color: var(--gm-accent-hi); }
.stress-pill-blood { border-color: rgba(192,57,43,0.4); }
.stress-pill-mind { border-color: rgba(93,83,167,0.4); }
.stress-pill-silver { border-color: rgba(176,141,87,0.4); }
.stress-pill-shadow { border-color: rgba(80,80,80,0.4); }
.stress-pill-reputation { border-color: rgba(60,130,90,0.4); }

/* =============================================
   SIDEBAR HOVER POPOVER
   ============================================= */

.sidebar-popover {
  position: fixed;
  z-index: 3000;
  min-width: 180px;
  max-width: 240px;
  background: var(--spire-deep);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  padding: 8px 10px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.45);
  pointer-events: none;
  opacity: 0;
  transform: translateX(-6px);
  transition: opacity 0.15s, transform 0.15s;
}
.sidebar-popover.visible {
  opacity: 1;
  transform: translateX(0);
}
.sp-name {
  font-family: 'Cinzel', serif;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--spire-text);
  margin-bottom: 5px;
  border-bottom: 1px solid var(--spire-border);
  padding-bottom: 4px;
}
.sp-line {
  font-size: 0.73rem;
  color: var(--spire-dim);
  padding: 1px 0;
  font-family: 'Crimson Pro', serif;
}

/* =============================================
   WEB FILTER BAR
   ============================================= */

#web-filter-bar {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-bottom: 1px solid var(--spire-border);
  background: var(--spire-dark);
  flex-shrink: 0;
  flex-wrap: wrap;
}
.filter-label {
  font-family: 'Cinzel', serif;
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--spire-dim);
}
.filter-pill {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 10px;
  font-family: 'Cinzel', serif;
  font-size: 0.68rem;
  letter-spacing: 0.05em;
  border: 1px solid var(--spire-border);
  color: var(--spire-dim);
  cursor: pointer;
  transition: all 0.15s;
  background: transparent;
  user-select: none;
  appearance: none;
  -webkit-appearance: none;
  outline: none;
}
.filter-pill.active {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--accent-hi);
}
.filter-sep { flex: 1; }

/* =============================================
   CANVAS CONTEXT MENU
   ============================================= */

.graph-context-menu {
  position: fixed;
  z-index: 4000;
  background: var(--spire-deep);
  border: 1px solid var(--spire-border);
  border-radius: var(--radius);
  padding: 4px 0;
  min-width: 200px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
}
.ctx-item {
  padding: 8px 14px;
  font-size: 0.82rem;
  cursor: pointer;
  color: var(--spire-text);
  font-family: 'Crimson Pro', serif;
  transition: background 0.1s;
}
.ctx-item:hover { background: var(--spire-mid); }
.ctx-item-danger {
  color: #e4a5a5;
  border-top: 1px solid var(--spire-border);
}
.ctx-item-danger:hover {
  background: rgba(192,57,43,0.14);
}
.ctx-item-cancel { color: var(--spire-dim); border-top: 1px solid var(--spire-border); margin-top: 2px; }

/* =============================================
   NPC SHEET: THREAT / DISPOSITION CHIPS
   ============================================= */

select option { background: var(--spire-deep); }

/* =============================================
   ORG SHEET: REACH / MINISTRY BADGES
   ============================================= */

/* =============================================
   TITLE BUTTONS
   ============================================= */

.sheet-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.sheet-title > div { display: flex; gap: 6px; }

/* Accessible keyboard focus for clickable stress pips */
.stress-pips .pip:focus-visible {
  outline: 2px solid var(--accent-hi);
  outline-offset: 2px;
}

/* Additional responsive rules for tablet/mobile layouts */
@media (max-width: 1100px) {
  :root {
    --sidebar-w: 236px;
    --inspector-w: 300px;
  }
  .tab-label { display: none; }
}

@media (max-width: 900px) {
  #top-nav {
    height: auto;
    min-height: var(--nav-h);
    flex-wrap: wrap;
  }
  .nav-left,
  .nav-middle,
  .nav-right {
    width: 100%;
  }
  .nav-middle {
    order: 3;
    justify-content: space-around;
    border-top: 1px solid var(--spire-border);
    padding-top: 6px;
  }
  #layout {
    height: calc(100vh - 98px);
  }
  #save-graph-view-btn,
  #delete-graph-view-btn {
    padding: 6px 9px;
    font-size: 0.65rem;
  }
}

@media (max-width: 700px) {
  #layout {
    flex-direction: column;
    height: calc(100vh - 108px);
  }
  #sidebar {
    width: 100%;
    max-height: 34vh;
    border-right: none;
    border-bottom: 1px solid var(--spire-border);
  }
  .add-btn span:not(.material-icons) {
    display: none;
  }
  .add-btn .material-icons {
    margin: 0;
  }
}
